# Тестовое задание на весеннюю стажировку РЕЛЭКС
## Задание
Разработать Restfull API service - биржу для проведения торгов криптовалютами
## Реализованные дополнительные требования
+ Подключена база данных PostgreSQL для хранения данных (скрипт создания БД находится в ресурсах)
+ Сервис может возвращать данные в Json или Xml, в зависимости от указанного accept в header HTTP-запроса
+ Использован Spring Security для разграничения ролей
+ Реализовано подтверждение регистрации по электронной почте
## Используемые технологии
+ Spring Boot
+ Spring Email
+ Spring Security
+ Hibernate
+ PostgreSQL
+ Lombok
+ ModelMapper
## Функциональность
> + Все запросы валидируются
> + Все запросы могуть быть возвращены в xml формате
### Регистрация нового пользователя
POST запрос - [/api/v1/clients]() - доступно всем
```json
"username": "user1",
"email": "user1@email.ru"
```
Ответ
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS",
"information": "Ключ будет активирован после подтверждения email. Для активации перейдите по ссылке в письме"
```
После отправки запроса проверяется уникальность имени пользователя и почты, генерируется секретный ключ,
для его активации необходимо подтвердить электронную почту, перейдя по ссылке в письме. Ссылка ведет на html страницу с результатом подтверждения.
При успешном подтверждении происходит создание пользовательских кошельков для всех валют
### Просмотр баланса своего кошелька
GET запрос - [/api/v1/wallets]() - доступно только пользователю
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS"
```
Ответ
```json
"BTC_wallet": "0.0031589",
"TON_wallet": "254.87",
"RUB_wallet": "3500"
```
Пользователь может запросить баланс всех своих кошельков. При запросе проверяется роль пользователя, если ключ валидный.
В ответ также может быть отправлена 403 ошибка или сообщение о неверном секретном ключе
### Пополнение кошелька
POST запрос - [/api/v1/wallets]() - доступно только пользователю
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS",
"RUB": "1000"
```
Ответ
```json
"RUB_wallet": "4500"
```
Пользователь может пополнить свой кошелек в **любой** валюте. В ответ возвращается обновленное количество валюты на кошельке.
Учтена минимальная сумма в каждой валюте, например минимальная сумма в BTC = 0.00000001, то есть пополнить меньше этой суммы нельзя.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе или сообщение о ошибке в валюте
### Вывод денег с биржи
POST запрос - [/api/v1/wallets/withdraw]() - доступно только пользователю
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS",
"currency": "RUB",
"count": "1500",
"credit_card": "1234 5678 9012 3456"
```
ИЛИ
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS",
"currency": "TON",
"count": "15",
"wallet": "AsS5A2SASd2as3q5sd2asd53a1s5"
```
Ответ
```json
"RUB_wallet": "3000"
```
Пользователь может выводить валюту на кошелек или на кредитную карту. В ответ возвращается обновленное количество валюты на кошельке.
Учтена минимальная сумма в каждой валюте, например минимальная сумма в BTC = 0.00000001, то есть вывести меньше этой суммы нельзя.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе, сообщение о ошибке в валюте или о недостаточном балансе
### Просмотр актуальных курсов валют
GET запрос - [/api/v1/rates]() - доступно пользователю и администратору
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS",
"currency": "TON"
```
Ответ
```json
"BTC": "0.00009564",
"RUB": "180"
```
Пользователь может просмотреть актуальные курсы валют. В ответ возвращается курс всех валют относительно указанной в запросе.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе и сообщение о ошибке в валюте
### Обмен валют по установленному курсу
POST запрос - [/api/v1/wallets/exchange]() - доступно только пользователю
```json
"secret_key": "$2a$10$lJAmmAuaM2Yk8H8thTc.OuKdZJDgf8dIBuFe/uukZicuLgrmMY5xS",
"currency_from": "RUB",
"currency_to": "TON",
"amount": "2000"
```
Ответ
```json
"currency_from": "RUB",
"currency_to": "TON",
"amount_from": "2000",
"amount_to": "11.11"
```
Пользователь может обменять валюту по установленному курсу. В ответ возвращается результат обмена.
Учтена минимальная сумма в каждой валюте, например минимальная сумма в BTC = 0.00000001, то есть обменять меньше этой суммы нельзя.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе, сообщение о ошибке в валюте или о недостаточном балансе
### Изменить курс валют
POST запрос - [/api/v1/rates]() - доступно только администатору
```json
"secret_key": "secret"
"base_currency": "TON",
"BTC": "0.000096",
"RUB": "184"
```
Ответ
```json
"BTC": "0.000096",
"RUB": "184"
```
Администратор может изменить курс валют относительно базовой, можно указывать любое количество валют. В ответ возвращаются измененные валюты.
Учтена минимальная сумма в каждой валюте, например минимальная сумма в BTC = 0.00000001, то есть указать меньше этой суммы нельзя.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе или сообщение о ошибке в валюте
### Просмотреть общую сумму на всех пользовательских счетах для указанной валюты
GET запрос - [/api/v1/stats/amount_currency]() - доступно только администратору
```json
"secret_key": "secret",
"currency": "RUB"
```
Ответ
```json
"RUB": "15006813",
```
Администратор может запросить общую сумму на всех пользовательских кошельках в определенной валюте.
В ответ возвращается общая сумма валют.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе или сообщение о ошибке в валюте
### Просмотреть количество операций, которые были проведены за указанный период
GET запрос - [/api/v1/stats/operations_count]() - доступно только администратору
```json
"secret_key": "1071daaabf1cda35d207030c898d07ff16c934b7"
"date_from": "18.02.2023",
"date_to": "19.02.2023"
```
Ответ
```json
"transaction_count": "154"
```
Администратор может просмотреть статистику по количеству операций на бирже. В ответ возвращается количество операций.
При запросе происходит валидация дат.
В ответ также может быть отправлена 403 ошибка, сообщение о неверном секретном ключе или сообщение о ошибке в датах
